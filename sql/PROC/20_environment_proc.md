## 生态环境监测业务线 —— 异常数据自动预警存储过程说明

为提升生态环境监测系统对异常环境数据的自动识别与响应能力，
系统在数据库层设计并实现了“异常数据自动预警”存储过程，
用于在环境监测数据产生后，自动完成异常判定与告警生成。

---

### 一、存储过程名称

**sp_env_auto_alert**

---

### 二、适用业务范围

- 生态环境监测业务线
- 环境数据采集、异常识别与预警管理场景

---

### 三、适用场景说明

该存储过程适用于以下典型业务场景：

1. **环境监测设备完成一次数据采集后**
   - 系统写入 `EnvironmentalData`
   - 随即调用存储过程进行异常判定

2. **实时监测与自动预警场景**
   - 自动判断监测值是否超出指标阈值
   - 减少人工干预与延迟响应

3. **环境异常集中管理**
   - 将异常数据统一转化为告警记录
   - 支撑后续告警查询、应急处置与决策分析

---

### 四、处理逻辑说明

存储过程主要完成以下处理流程：

1. 根据环境数据编号获取监测值及指标上下限
2. 判断监测值是否超出设定阈值
3. 若监测值异常，将环境数据的异常标识（is_abnormal）设为1（正常为0）
4. 若数据异常且尚未生成告警，则自动插入告警记录
5. 通过去重判断，避免同一数据重复触发告警

---

### 五、设计说明

- 存储过程在数据库层完成核心业务逻辑，减少应用层复杂度
- 异常判定逻辑统一，避免不同系统模块判断不一致
- 支持后续扩展告警等级与复杂预警规则
- 与环境异常视图、告警索引设计形成完整的数据处理闭环
