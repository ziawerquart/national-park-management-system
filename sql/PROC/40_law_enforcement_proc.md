# 执法监管业务线存储过程设计说明文档
## 文档信息
- 文件名：40_law_enforcement_proc.sql
- 存储过程名：proc_law_enforcement_statistic
- 所属业务：执法监管多维度统计分析
- 适配库表：Region、IllegalBehaviorRecord、LawEnforcementOfficer、LawEnforcementDispatch
- 数据库版本：MySQL8.0+
- ✅ 已修复：零除错误、时间范围不匹配、关联逻辑失效问题

## 一、核心功能
实现执法监管**一站式多维度统计分析**，一次性输出「区域案件统计、执法人员工作量排行、调度效率统计」3类核心结果集，适配**测试库全量统计**和**正式库时段统计**两种场景，执行零报错、数据精准。

## 二、入参说明（优化版）
| 参数名 | 数据类型 | 是否必填 | 默认值 | 核心说明 |
|--------|----------|----------|--------|----------|
| start_time | DATETIME | 否 | 1970-01-01 | 传NULL=统计全量数据；传时间=指定统计开始时间 |
| end_time | DATETIME | 否 | 当前时间 | 传NULL=统计全量数据；传时间=指定统计结束时间 |

### ✅ 入参核心规则（适配你的场景）
1. **不传参（推荐）**：`CALL proc_law_enforcement_statistic(NULL, NULL);` → 统计**所有历史案件**，直接出有效数据；
2. **传时间**：`CALL proc_law_enforcement_statistic('2024-01-01','2024-12-31');` → 统计指定时间段数据；
3. 完全兼容你的测试库（2024年历史数据）、正式库（实时数据）。

## 三、输出结果集说明
### ✅ 结果集1：各区域案件统计
- 输出字段：region_id、region_name、case_count、high_freq_behavior、close_rate
- 核心价值：统计各保护区案件总量、识别高发违规类型、计算结案率，定位防控重点区域；
- 排序规则：按案件数量降序，高发区域优先展示。

### ✅ 结果集2：执法人员工作量TOP10
- 输出字段：law_id、name、department、handle_case_count、close_case_count、close_rate
- 核心价值：按办案量排行，统计人员办结率，支撑月度/季度考核；
- 排序规则：按承办案件数降序，取TOP10，适配考核场景。

### ✅ 结果集3：执法调度效率统计
- 输出字段：total_dispatch_count、completed_count、dispatch_complete_rate、avg_response_time、avg_finish_time
- 核心价值：量化调度效率，自动计算平均响应/办结时长，定位调度流程瓶颈。

## 四、适用范围（严格匹配初始要求）
### ✅ 场景1：管理层定期报表（核心）
- 适用人员：执法监管管理员、运营人员；
- 频次：每日/每周/每月；
- 价值：一键生成3类统计数据，报表制作效率提升80%+。

### ✅ 场景2：执法人员考核
- 适用人员：执法部门负责人、人力资源；
- 频次：月度/季度；
- 价值：自动输出工作量排行、办结率，考核数据客观可追溯。

### ✅ 场景3：区域防控决策
- 适用人员：保护区防控负责人；
- 价值：定位高发区域、高发违规类型，支撑执法资源调配。

### ✅ 场景4：调度流程优化
- 适用人员：调度中心负责人；
- 价值：量化响应/办结时长，优化执法调度流程，提升效率。

## 五、调用示例（直接复制执行，必出数据）
### ✅ 示例1：默认调用【测试库专用，推荐】→ 统计全量历史案件
```sql
CALL proc_law_enforcement_statistic(NULL, NULL);