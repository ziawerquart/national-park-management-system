# 游客管理业务线触发器说明

## 1. check_out_of_route

**适用范围**:
- 用于在插入轨迹记录时自动判断是否越界
- 适用于安全监控系统进行实时越界行为检测
- 适用于景区管理进行游客行为规范

**触发时机**:
- 在插入VisitorTrajectory表之前

**逻辑说明**:
- 如果游客在非限制区域（region_type != 'restricted'）有轨迹记录，则标记为越界（is_out_of_route = TRUE）
- 否则，标记为正常（is_out_of_route = FALSE）

## 2. log_reservation_status_change

**适用范围**:
- 用于在预约状态变更时自动记录变更日志
- 适用于预约管理系统进行状态追踪
- 适用于财务系统进行收入确认

**触发时机**:
- 在更新Reservation表之后

**逻辑说明**:
- 当预约状态发生变化时，记录变更前后的状态和变更时间
- 便于后续进行状态追踪和审计